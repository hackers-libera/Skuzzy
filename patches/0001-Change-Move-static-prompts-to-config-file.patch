From 565bf920e604276f037287e1910b04f152b13211 Mon Sep 17 00:00:00 2001
From: Ritchie Cunningham <ritchie@ritchiecunningham.co.uk>
Date: Fri, 14 Nov 2025 22:14:21 +0000
Subject: [PATCH 1/8] [Change] Move static prompts to config file.

---
 cmd/skuzzy/deepseek.go         | 12 +-----------
 cmd/skuzzy/reminder_handler.go |  4 +---
 cmd/skuzzy/reminders.go        | 12 ++++--------
 libera-example.yaml            | 18 ++++++++++++++++--
 4 files changed, 22 insertions(+), 24 deletions(-)

diff --git a/cmd/Skuzzy/deepseek.go b/cmd/Skuzzy/deepseek.go
index 496d2a0..b85c68f 100644
--- a/cmd/Skuzzy/deepseek.go
+++ b/cmd/Skuzzy/deepseek.go
@@ -54,17 +54,7 @@ func Deepseek(settings *ServerConfig, llm LLM) {
 		currentSysPrompt := req.sysprompt
 		if req.PromptName == "reminder_parse" {
 			/* Specific prompt for parsing reminders. */
-			currentSysPrompt = "You are a reminder parsing assistant. Your only job " +
-													"is to  analyse the following text and extract the " +
-													"duration and the reminder message. " +
-													"Respond ONLY with a JSON object with two fields: " +
-													"\"is_reminder\" (boolean), \"duration_minutes\" (integer) " +
-													"and \"reminder_message\" (string). Convert all " +
-													"durations (e.g., hours) to minutes. If you cannot " +
-													"determine the duration or message, set \"is_reminder\" " +
-													"to false. Example: " +
-													"{\"is_reminder\": true, \"duration_minutes\": 120, " +
-													"\"reminder_message\": \"Get food!\"}"
+			currentSysPrompt = settings.SysPrompts["reminder_parse"]
 		}
 
 		request := &deepseek.ChatCompletionRequest{
diff --git a/cmd/Skuzzy/reminder_handler.go b/cmd/Skuzzy/reminder_handler.go
index 7e159a6..bd79aad 100644
--- a/cmd/Skuzzy/reminder_handler.go
+++ b/cmd/Skuzzy/reminder_handler.go
@@ -48,9 +48,7 @@ func ReminderHandler(settings *ServerConfig) {
 				channel:		parsedData.OriginalReq.channel,
 				request:		fmt.Sprintf("You have scheduled a reminder for %s in %d minutes to %s.",
 																reminder.User, result.DurationMinutes, reminder.Message),
-				sysprompt:	"You are a helpful assistant. Confirm to the " +
-										"user that their reminder has been scheduled in " +
-										"your unique style.",
+				sysprompt: settings.SysPrompts["reminder_confirm"],
 				PromptName:	"reminder_confirm",
 				User:				parsedData.OriginalReq.User,
 			}
diff --git a/cmd/Skuzzy/reminders.go b/cmd/Skuzzy/reminders.go
index 4cec3ed..1d833ae 100644
--- a/cmd/Skuzzy/reminders.go
+++ b/cmd/Skuzzy/reminders.go
@@ -40,18 +40,14 @@ func AddReminder(settings *ServerConfig, reminder *Reminder) {
 	   * When the timer fires, create a request for the LLM to generate
 	   * the reminder message.
 	   */
-		reminderPrompt := fmt.Sprintf("It's time to remind the user %s to %s. "		+
-																	"Create a reminder message in your unique "	+
-																	"style. Be sure to ping the user.",
-																	reminder.User, reminder.Message)
-
-		/* Send the default prompt. */
-		_, sysPrompt := FindPrompt(settings, "deepseek", reminder.Channel, "reminder")
+		reminderPrompt := fmt.Sprintf(settings.SysPrompts["reminder_fire"],
+											reminder.User, reminder.Message)
 
+		/* Send the reminder_fire prompt. */
 		req := DeepseekRequest {
 			channel:		reminder.Channel,
 			request:		reminderPrompt,
-			sysprompt:	sysPrompt,
+			sysprompt:	settings.SysPrompts["reminder_fire"],
 		}
 		DeepseekQueue <- req
 
diff --git a/libera-example.yaml b/libera-example.yaml
index 91637b2..796df8e 100644
--- a/libera-example.yaml
+++ b/libera-example.yaml
@@ -25,11 +25,25 @@ channels:
   - testchan:
     name: '#skuzzy'
     llm: deepseek
-    sys_prompts_enabled: [default,greet]   
+    sys_prompts_enabled: [default,greet]
   - bettola:
     name: '#bettola'
     llm: deepseek
-    sys_prompts_enabled: [default,greet]  
+    sys_prompts_enabled: [default,greet]
 sys_prompts:
   greet: Greet users in an IRC channel, be original. The user is {USER} the channel is  {CHANNEL}
   default: https://raw.githubusercontent.com/hackers-libera/Skuzzy/refs/heads/main/default.txt
+  reminder_parse: >-
+    You are a reminder parsing assistant. Your only job is to analyse the
+    following text and extract the duration and the reminder message.
+    Respond ONLY with a JSON object with two fields: "is_reminder" (boolean),
+    "duration_minutes" (integer) and "reminder_message" (string). Convert all
+    durations (e.g., hours) to minutes. If you cannot determine the duration
+    or message, set "is_reminder" to false. Example:
+    {"is_reminder": true, "duration_minutes": 120, "reminder_message": "Get food!"}
+  reminder_confirm: >-
+    You are a helpful assistant. Confirm to the user that their reminder has been
+    scheduled in your unique style.
+  reminder_fire: >-
+    It's time to remind the {USER} to {MESSAGE}. Create a reminder message
+    in your unique style. Be sure to ping the user.
-- 
2.48.1

